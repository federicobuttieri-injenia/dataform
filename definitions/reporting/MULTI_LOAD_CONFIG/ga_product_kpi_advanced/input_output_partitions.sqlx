config {
    type: "view",
    schema: "injenia",
    name: "ga_product_kpi_advanced_input_output_partitions"
}

SELECT DISTINCT PARSE_DATE('%Y%m%d', event_date)
FROM ${ref("events_*")}
WHERE _TABLE_SUFFIX = (SELECT * FROM ${ref("ga_product_kpi_advanced_get_last_shard")})
AND PARSE_DATE('%Y%m%d', event_date) NOT IN (
	SELECT event_date
	FROM ${ref("F_GA_PRODUCT_KPI_ADVANCED_*")}
)
		